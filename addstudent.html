<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <link rel="stylesheet" href="./assets/css/addcert.css" />
    <link rel="stylesheet" href="./assets/css/grid.css" />
	<link rel="stylesheet" href="./assets/css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js">
   </script>
    <title>Add Student</title>
  </head>
  <body>
    <p w3-include-html="header.html"></p>

    <div class="grid wide cert__wrap">
      <div class="row cert_custom mt30 mb30">
        <div class="col l-6 m-12 c-12 cert__info">
          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">ID sinh viên</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="idStudent"
                name="id"
                type="text"
                class="cert__receiver"
                placeholder="Nhập ID sinh viên"
              />
            </div>
          </div>

          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">Tên sinh viên</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="nameStudent"
                name="name"
                type="text"
                class="cert__name"
                placeholder="Nhập tên sinh viên"
              />
            </div>
          </div>

          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">Ngành học</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="majors"
                name="receiver"
                type="text"
                class="cert__receiver"
                placeholder="Nhập ngành học"
              />
            </div>
          </div>

          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">Ngày sinh</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="birth"
                name="date"
                type="date"
                class="cert__date"
                placeholder="Nhập ngày sinh sinh viên"
                onchange="console.log(this.value);"
              />
            </div>
          </div>

          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">Giới tính</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="sex"
                name="sex"
                type="text"
                class="cert__name"
                placeholder="Nhập giới tính sinh viên"
              />
            </div>
          </div>

          <div class="row mb-10">
            <div class="col l-4 m-4 c-4">
              <div class="cert__title">Email</div>
            </div>
            <div class="col l-8 m-8 c-8">
              <input
                id="email"
                name="receiver"
                type="text"
                class="cert__receiver"
                placeholder="Nhập Email sinh viên"
              />
            </div>
          </div>
          <a onclick="addStudent()" href="#" class="btn">Thêm</a>
        </div>

        <div class="col l-6 m-12 c-12">
          <img src="./assets/image/334.jpg" alt="" style="width: 100%" />
        </div>
      </div>
    </div>

    <p w3-include-html="footer.html"></p>
    <script>
      w3.includeHTML();

      //1- connect metamask
      let account;
      //2- connect smart contract
      const addStudent = async () => {

        if (window.ethereum !== "undefined") {
          const accounts = await ethereum.request({
            method: "eth_requestAccounts",
          });
          account = accounts[0];
        }

        const ABI = [
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_idCertificate",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_nameCertificate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_nameStudent",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_releaseDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_expirationDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_issuer",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_idStudent",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_grade",
				"type": "string"
			}
		],
		"name": "addCertificate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_idStudent",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_majors",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_sex",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_birth",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			}
		],
		"name": "addStudent",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "certificateId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "nameCertificate",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "nameStudent",
				"type": "string"
			}
		],
		"name": "savedCertificate",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "idStudent",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "savedStudent",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_idCertificate",
				"type": "uint256"
			}
		],
		"name": "getCertificateById",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_idStudent",
				"type": "string"
			}
		],
		"name": "getCertificatesByStudentId",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_idStudent",
				"type": "string"
			}
		],
		"name": "getStudentCertificates",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "idCertificate",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "nameCertificate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "nameStudent",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "releaseDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "expirationDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "issuer",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "grade",
						"type": "string"
					}
				],
				"internalType": "struct CertificateManagement.Certificate[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        const Address = "0xA0Fb9CbA3C58Fd4eA7050388657Bc91041518340";
        window.web3 = await new Web3(window.ethereum);
        window.contract = await new window.web3.eth.Contract(ABI, Address);

        //3- send student data
        let _idStudent, _name, _majors, _sex, _birth, _email;
        _idStudent = document.getElementById("idStudent").value;
        _name = document.getElementById("nameStudent").value;
        _majors = document.getElementById("majors").value;
        _sex = document.getElementById("sex").value;
        _birth = document.getElementById("birth").value;
        _email = document.getElementById("email").value;

        await window.contract.methods
          .addStudent(_idStudent, _name, _majors, _sex, _birth, _email)
          .send({ from: account });
      };
    </script>
  </body>
</html>
