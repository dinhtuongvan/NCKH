<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <link rel="stylesheet" href="./assets/css/mycert.css" />
    <link rel="stylesheet" href="./assets/css/grid.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <title>My Certificate</title>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js">
   </script>
  </head>
  <body>
    <p w3-include-html="header_stu.html"></p>

    <div class="grid wide cert__wrap">
      <div class="row mt30 cert_custom">
        <div class="col l-4">
          <img src="./assets/image/toeic.jpg" alt="" class="cert__img" />
          <!-- <div id="cert__img" style="width: 100%; height: 100%"></div> -->
        </div>
        <div class="col l-8">
          <div class="cert__info-wrap">
            <div class="cert__info">
              <h1 class="cert__name">TOEIC ETS</h1>
              <div class="cert__detail--wrap">
                <p class="label">ID:</p>
                <p class="cert__id">ENG11111</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Họ tên:</p>
                <p class="cert__receiver">Đinh Tường Văn</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày phát hành:</p>
                <p class="cert__receiver">22-08-2023</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày hết hạn:</p>
                <p class="cert__receiver">22-08-2025</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Xếp loại:</p>
                <p class="cert__receiver">880</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Đơn vị phát hành:</p>
                <p class="cert__receiver">ETS</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Trạng thái:</p>
                <p class="cert__status">
                  <span>Đang phát hành</span>
                </p>
              </div>

              <p class="cert__date"></p>
              <p class="cert__outdate"></p>
              <p class="cert__rank"></p>
              <p class="cert__issuer"></p>
            </div>
            <a href="#" class="cert__code">Nhận mã chứng chỉ</a>
          </div>
        </div>
      </div>

      <div class="row mt30 cert_custom">
        <div class="col l-4">
          <img src="./assets/image/ielts.jpg" alt="" class="cert__img" />
        </div>
        <div class="col l-8">
          <div class="cert__info-wrap">
            <div class="cert__info">
              <h1 class="cert__name">TOEIC ETS</h1>
              <div class="cert__detail--wrap">
                <p class="label">ID:</p>
                <p class="cert__id">ENG11111</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Họ tên:</p>
                <p class="cert__receiver">Đinh Tường Văn</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày phát hành:</p>
                <p class="cert__receiver">22-08-2023</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày hết hạn:</p>
                <p class="cert__receiver">22-08-2025</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Xếp loại:</p>
                <p class="cert__receiver">880</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Đơn vị phát hành:</p>
                <p class="cert__receiver">ETS</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Trạng thái:</p>
                <p class="cert__status">
                  <span>Đang phát hành</span>
                </p>
              </div>

              <p class="cert__date"></p>
              <p class="cert__outdate"></p>
              <p class="cert__rank"></p>
              <p class="cert__issuer"></p>
            </div>
            <a href="" class="cert__code">Nhận mã chứng chỉ</a>
          </div>
        </div>
      </div>

      <div class="row mt30 mb30 cert_custom">
        <div class="col l-4">
          <img src="./assets/image/TN.png" alt="" class="cert__img" />
        </div>
        <div class="col l-8">
          <div class="cert__info-wrap">
            <div class="cert__info">
              <h1 class="cert__name">TOEIC ETS</h1>
              <div class="cert__detail--wrap">
                <p class="label">ID:</p>
                <p class="cert__id">ENG11111</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Họ tên:</p>
                <p class="cert__receiver">Đinh Tường Văn</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày phát hành:</p>
                <p class="cert__receiver">22-08-2023</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày hết hạn:</p>
                <p class="cert__receiver">22-08-2025</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Xếp loại:</p>
                <p class="cert__receiver">880</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Đơn vị phát hành:</p>
                <p class="cert__receiver">ETS</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Trạng thái:</p>
                <p class="cert__status">
                  <span>Đang phát hành</span>
                </p>
              </div>

              <p class="cert__date"></p>
              <p class="cert__outdate"></p>
              <p class="cert__rank"></p>
              <p class="cert__issuer"></p>
            </div>
            <a href="" class="cert__code">Nhận mã chứng chỉ</a>
          </div>
        </div>
      </div>
    </div>

    <p w3-include-html="footer.html"></p>
    <script>
      w3.includeHTML();

      //1- connect metamask
      let account;
      const connectMetamask = async () => {
        if (window.ethereum !== "undefined") {
          const accounts = await ethereum.request({
            method: "eth_requestAccounts",
          });
          account = accounts[0];
          document.getElementById("accountArea").innerHTML = account;
        }
      };

      //2- connect smart contract
      const getCertificates = async () => {
        const ABI = [
          {
            inputs: [
              {
                internalType: "uint256",
                name: "_idCertificate",
                type: "uint256",
              },
              {
                internalType: "string",
                name: "_nameCertificate",
                type: "string",
              },
              {
                internalType: "string",
                name: "_nameStudent",
                type: "string",
              },
              {
                internalType: "string",
                name: "_releaseDate",
                type: "string",
              },
              {
                internalType: "string",
                name: "_expirationDate",
                type: "string",
              },
              {
                internalType: "string",
                name: "_issuer",
                type: "string",
              },
              {
                internalType: "string",
                name: "_idStudent",
                type: "string",
              },
              {
                internalType: "string",
                name: "_grade",
                type: "string",
              },
            ],
            name: "addCertificate",
            outputs: [],
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            inputs: [
              {
                internalType: "string",
                name: "_idStudent",
                type: "string",
              },
              {
                internalType: "string",
                name: "_name",
                type: "string",
              },
              {
                internalType: "string",
                name: "_majors",
                type: "string",
              },
              {
                internalType: "string",
                name: "_sex",
                type: "string",
              },
              {
                internalType: "string",
                name: "_birth",
                type: "string",
              },
              {
                internalType: "string",
                name: "_email",
                type: "string",
              },
            ],
            name: "addStudent",
            outputs: [],
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            inputs: [],
            stateMutability: "nonpayable",
            type: "constructor",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "uint256",
                name: "certificateId",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "string",
                name: "nameCertificate",
                type: "string",
              },
              {
                indexed: false,
                internalType: "string",
                name: "nameStudent",
                type: "string",
              },
            ],
            name: "savedCertificate",
            type: "event",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "idStudent",
                type: "string",
              },
              {
                indexed: false,
                internalType: "string",
                name: "name",
                type: "string",
              },
            ],
            name: "savedStudent",
            type: "event",
          },
          {
            inputs: [
              {
                internalType: "uint256",
                name: "_idCertificate",
                type: "uint256",
              },
            ],
            name: "getCertificateById",
            outputs: [
              {
                internalType: "uint256",
                name: "",
                type: "uint256",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [
              {
                internalType: "string",
                name: "_idStudent",
                type: "string",
              },
            ],
            name: "getCertificatesByStudentId",
            outputs: [
              {
                internalType: "uint256[]",
                name: "",
                type: "uint256[]",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [
              {
                internalType: "string",
                name: "_idStudent",
                type: "string",
              },
            ],
            name: "getStudentCertificates",
            outputs: [
              {
                components: [
                  {
                    internalType: "uint256",
                    name: "idCertificate",
                    type: "uint256",
                  },
                  {
                    internalType: "string",
                    name: "nameCertificate",
                    type: "string",
                  },
                  {
                    internalType: "string",
                    name: "nameStudent",
                    type: "string",
                  },
                  {
                    internalType: "string",
                    name: "releaseDate",
                    type: "string",
                  },
                  {
                    internalType: "string",
                    name: "expirationDate",
                    type: "string",
                  },
                  {
                    internalType: "string",
                    name: "issuer",
                    type: "string",
                  },
                  {
                    internalType: "string",
                    name: "grade",
                    type: "string",
                  },
                ],
                internalType: "struct CertificateManagement.Certificate[]",
                name: "",
                type: "tuple[]",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
        ];
        const Address = "0x0949aa7639822d96330943043f382e8149D8320B";
        window.web3 = await new Web3(window.ethereum);
        window.contract = await new window.web3.eth.Contract(ABI, Address);

        //3- get data from smart contract
        const data = await window.contract.methods
          .getStudentCertificates("1")
          .call();

        var listCoursesBlock = document.querySelector("#cert_auto");

        var htmls = data.map(function (data_item) {
          return `
    <div class="row mt30 cert_custom">
        <div class="col l-4">
          <img src="" alt="" class="cert__img">
        </div>
        <div class="col l-8">
          <div class="cert__info-wrap">
            <div class="cert__info">
              <h1 class="cert__name">${data_item[0]}</h1>
              <div class="cert__detail--wrap">
                <p class="label">ID:</p>
                <p class="cert__id">${data_item[1]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Họ tên:</p>
                <p class="cert__receiver">${data_item[2]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày phát hành:</p>
                <p class="cert__receiver">${data_item[3]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Ngày hết hạn:</p>
                <p class="cert__receiver">${data_item[4]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Xếp loại:</p>
                <p class="cert__receiver">${data_item[5]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Đơn vị phát hành:</p>
                <p class="cert__receiver">${data_item[6]}</p>
              </div>
              <div class="cert__detail--wrap">
                <p class="label">Trạng thái:</p>
                <p class="cert__status">
                  <span>Đang phát hành</span>
                </p>
              </div>

              <p class="cert__date"></p>
              <p class="cert__outdate"></p>
              <p class="cert__rank"></p>
              <p class="cert__issuer"></p>
            </div>
            <a href="#" class="cert__code"
              >Nhận mã chứng chỉ</a
            >
          </div>
        </div>
      </div>
    `;
        });

        listCoursesBlock.innerHTML = htmls.join("");
      };
    </script>
  </body>
</html>
